{% extends "base.html" %}
{% block title %}{{ STORES.get(store_id, store_id) }} - {{ year }}年{{ month }}月 シフト表{% endblock %}

{% block content %}
<h1>{{ STORES.get(store_id, store_id) }} - {{ year }}年{{ month }}月 シフト表</h1>

<div class="navline">
  <a class="btn" href="{{ url_for('view', store_id=store_id, year=prev_y, month=prev_m) }}">« 前月</a>
  <a class="btn" href="{{ url_for('view', store_id=store_id, year=next_y, month=next_m) }}">次月 »</a>
  <div class="spacer"></div>
  <a class="btn" href="{{ url_for('schedule', store_id=store_id, year=year, month=month) }}">編集</a>
  <a class="btn" href="{{ url_for('logout', store_id=store_id) }}">ログアウト</a>
</div>

{% set first_wday = (calendar.weekday(year, month, 1) + 1) % 7 %}
{% set nd = ndays %}

<div class="cal-grid only-desktop">
  <div class="cal-header">
    <div class="cell head">週</div>
    {% for wd in range(7) %}
      <div class="cell head">{{ ["日","月","火","水","木","金","土"][wd] }}</div>
    {% endfor %}
  </div>

  {% for w in range(6) %}
  <div class="cal-row">
    <div class="cell weekno">第{{ w+1 }}週</div>
    {% for wd in range(7) %}
      {% set d = (w*7 + wd - first_wday + 1) %}
      {% if 1 <= d <= nd %}
        {% set cls = "day" %}
        {% if wd == 0 %}{% set cls = cls + " sun" %}{% elif wd == 6 %}{% set cls = cls + " sat" %}{% endif %}
        <div class="cell {{ cls }}">
          <div class="daynum">{{ d }}日</div>
          <div class="shifts">
            {% for key, label, cap in [("am0","早朝",1),("am","午前",2),("pm","午後",2),("eve","夕方",2),("night","深夜",1)] %}
              {% set names = (data.get(d|string, {}).get(key, [])|default([])) %}
              <div class="shift-line">
                <div class="shift-label">{{ label }}</div>
                <div class="shift-names">
                  {% if names %}
                    {% for n in names %}<span class="pill">{{ n }}</span>{% endfor %}
                  {% else %}
                    <span class="muted">—</span>
                  {% endif %}
                </div>
              </div>
            {% endfor %}
          </div>
        </div>
      {% else %}
        <div class="cell"></div>
      {% endif %}
    {% endfor %}
  </div>
  {% endfor %}
</div>

<div class="only-mobile">
  {% for d in range(1, nd+1) %}
  <div class="day-card">
    <div class="daycard-head">
      <div class="daynum">{{ d }}日</div>
      {% set wd = (calendar.weekday(year, month, d) + 1) % 7 %}
      <div class="weekday"><span class="{% if wd==0 %}sun{% elif wd==6 %}sat{% endif %}">
        （{{ ["日","月","火","水","木","金","土"][wd] }}）
      </span></div>
    </div>
    {% for key, label, cap in [("am0","早朝",1),("am","午前",2),("pm","午後",2),("eve","夕方",2),("night","深夜",1)] %}
      {% set names = (data.get(d|string, {}).get(key, [])|default([])) %}
      <div class="mrow">
        <div class="mlabel">{{ label }}</div>
        <div class="mnames">
          {% if names %}
            {% for n in names %}<span class="pill">{{ n }}</span>{% endfor %}
          {% else %}
            <span class="muted">—</span>
          {% endif %}
        </div>
      </div>
    {% endfor %}
  </div>
  {% endfor %}
</div>
{% endblock %}
